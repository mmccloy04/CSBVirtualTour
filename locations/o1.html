<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://cdn.glitch.global/189c5b32-4e8b-4e96-b443-5aae4d110245/qublogo.png?v=1706269760196" /> <!--Queens logo sourced from https://www.stickpng.com/img/icons-logos-emojis/russell-group-universities/queens-university-belfast-logo -->
    <title>EEECS VR Tour</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="../../../js/script.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.misc.min.js"></script> <!-- script for hand controls and animation sourced from https://www.youtube.com/watch?v=vQ85u3dzmZY and https://github.com/c-frame/aframe-super-hands-component-->
    <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script> <!-- script for superhands sourced from https://github.com/c-frame/aframe-super-hands-component-->
    <script src="https://unpkg.com/aframe-event-set-component@5.x.x/dist/aframe-event-set-component.min.js"></script> <!-- script for event set component sourced from https://aframe.io/docs/1.5.0/guides/building-a-360-image-gallery.html -->

    <!-- CUSTOM COMPONENT
    Registering a custom component to have one entity face another entity (used to make objects face the user)
    Sourced from https://stackoverflow.com/questions/66508949/a-frame-make-model-face-the-viewer-center-of-the-screen-or-canvas -->
    <script>
      AFRAME.registerComponent("look-at", {
        schema: { type: "selector" },

        init: function () {},

        tick: function () {
          this.el.object3D.lookAt(this.data.object3D.position);
        },
      });
    </script>
    
    <!--CONTROLLER COMPONENT
    Used to support all the controller components, while providing the hand and overriding the model.
    Sourced from aframe.io/docs/1.5.0/introduction/interactions-and-controllers.html#creating-custom-controllers -->
    <script>
      AFRAME.registerComponent("custom-controls", {
        schema: {
          hand: { default: "" },
          model: { default: "customControllerModel.gltf" },
        },
        update: function () {
          var hand = this.data.hand;
          var el = this.el;
          var controlConfiguration = {
            hand: hand,
            model: false,
            orientationOffset: { x: 0, y: 0, z: hand === "left" ? 90 : -90 },
          };
          // Build on top of controller components.
          el.setAttribute("vive-controls", controlConfiguration);
          el.setAttribute("oculus-touch-controls", controlConfiguration);
          el.setAttribute("windows-motion-controls", controlConfiguration);
          // Set a model.
          el.setAttribute("gltf-model", this.data.model);
        },
      });
    </script>
    
    <!--COMPONENT TO DETECT WHEN THE STUDENT CARD HITS THE READER (WILL THEN TURN GREEN) 
    Sourced/adapted from https://stackoverflow.com/questions/53673673/aframe-sphere-collider-trigger-function-on-collision-->
    <script>
    AFRAME.registerComponent('collide', {
      init: function() {
        this.el.addEventListener('hit', (e) => {
          //timeout function sourced/adapted fromhttps://stackoverflow.com/questions/68295433/a-frame-trigger-function-when-two-objects-touch
          setTimeout(() => {
             document.querySelector('#scanner').setAttribute('color', 'green')
          }, 300)
          setTimeout(() => {
              document.querySelector('#g1').setAttribute('visible', 'true') 
           }, 400)
                    })
        this.el.addEventListener('hitend', (e) => {
          console.log('hitend')
          document.querySelector('#scanner').setAttribute('color', 'black') 
          document.querySelector('#g1').setAttribute('visible', 'false') 
        })
      }
    })
    </script>
    
  </head>

  <body>
    <a-scene>
      
      <!--ASSETS-->
      <a-assets>
        <!--assets for icons-->
        <img id="video_icon" src="https://cdn.glitch.global/943a3cf6-3872-4e08-b494-74ea4b0fdad8/video2.png?v=1706308587519">
        <img id="task_icon" src="https://cdn.glitch.global/943a3cf6-3872-4e08-b494-74ea4b0fdad8/task5.png?v=1706309028596">
        
        <!--360 images for locations-->
        <img id="g1_image" src="https://cdn.glitch.global/0ecceb09-097f-4efc-83ce-6923956c956e/003_mainfoyer_bydoor.jpg?v=1698966152686">
        <img id="o1_image" src="https://cdn.glitch.global/0ecceb09-097f-4efc-83ce-6923956c956e/074_topofsteps_somepeople.jpg?v=1698964827198">
        <img id="o4_image" src="https://cdn.glitch.global/0ecceb09-097f-4efc-83ce-6923956c956e/079_bottomofsteps_somepeople.jpg?v=1698964838558">
        
        <!-- assets for interactive scenarios -->
        <img id="studentcard_image" src="https://cdn.glitch.global/8cefb064-2b3f-4ee6-95b2-81aed480e217/studentcard.jpg?v=1704470277619">
      </a-assets>

      <!--CAMERA AND CONTROLS-->
      <a-entity>
        <a-camera position="1 1 0" id="myCamera" cursor="rayOrigin: mouse"></a-camera>
        <a-entity sphere-collider="objects: a-plane, a-box, a-sphere" super-hands hand-controls="hand: right"></a-entity>  <!-- Right hand implements hand controls with superhands, adapted/sourced from https://github.com/c-frame/aframe-super-hands-component -->
        <a-entity oculus-touch-controls="hand: left" thumbstick-logging></a-entity> <!--Left hand is the controller, adapted/sourced from https://aframe.io/docs/1.5.0/components/oculus-touch-controls.html -->
        <a-entity laser-controls="hand: left"></a-entity> <!--Left hand (controller) has laser, adapted/sourced from https://aframe.io/docs/1.5.0/components/laser-controls.html -->
      </a-entity>
      
      <!--BACKGROUND-->
      <a-sky src="#o1_image" rotation="0 -133 0"></a-sky>
    
      <!--SPHERES LINKING TO OTHER LOCATIONS -->
      <a-sphere id="o4" position="-6 -1.5 7" radius="1" src="#o4_image"
       event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
        event-set__leave="_event: mouseleave; scale: 1 1 1">
        <a-text font="kelsonsans" value="This way to the\nFire Assembly Point" width="7" position="0 -1.5 0" align="center" look-at="#myCamera"></a-text>
      </a-sphere>
      
      <a-sphere id="g1" position="6.3 1.5 -6" radius="1" src="#g1_image" visible="false"
        event-set__enter="_event: mouseenter; scale: 1.2 1.2 1.2"
        event-set__leave="_event: mouseleave; scale: 1 1 1">
        <a-text font="kelsonsans" value="Go Inside" width="7" position="0 -1.3 0" align="center" look-at="#myCamera"></a-text>
      </a-sphere>
      
      <!--OBJECTS FOR VIDEOS/AUDIO-->
      <a-box id="video_o2" position="10.5 2 -1" src="#video_icon"
          event-set__enter="_event: mouseenter; _target: #o2Text; visible: true"
          event-set__leave="_event: mouseleave; _target: #o2Text; visible: false">
          <a-text id="o2Text" value="Click to play video\nof students coming out" align="center" color="#FFFFFF" width="7" font="kelsonsans" 
          visible="false" position="0.05 1.5 0.05" geometry="primitive: plane; width: 5" material="color: #333333" look-at="#myCamera"></a-text>
      </a-box>
      
      <!--TASK-->
      <a-box id="task" position="10.5 0.5 -1" src="#task_icon" 
        event-set__enter="_event: mouseenter; _target: #taskText; visible: true"
        event-set__leave="_event: mouseleave; _target: #taskText; visible: false">
        <a-text id="taskText" value="Your first task is click on your student card to scan it on the reader. Once successfully scanned, the reader will turn green and you will be able to go inside." align="center" color="#FFFFFF" width="7" font="kelsonsans" 
        visible="false" position="0.05 -2 -0.05" geometry="primitive: plane; width: 7; height: 2" material="color: #333333" look-at="#myCamera"></a-text>
      </a-box>
      
      
      <!-- INTERACTIVE SCENARIOS-->
     
      <!--TESTING WITH BOXES
      <a-box id="scanner" class="collidable"  sphere-collider="" height="1" width="1" depth="1" position="-1 0.5 -3"  color="black"></a-box>
      <a-box position="3 0.5 -3" animation="property: position; to: -3 0.5 -3  ; dur: 2000; easing: linear; loop: false" color="tomato" foo></a-box>
          if animation finish position is -0.5 0.5 -3 they touch and goes green
          if animation finish position is 0.1 -1 -1.1 they dont touch and it doesnt go green
          if animation finish position is -3 0.5 -3 they touch then stop touching so goes green then black-->
      
       <!--ANIMATION COMPONENT USED TO SCAN CARD ON READER, COMPONENT USED TO TURN SCANNER GREEN WHEN THE OBJECTS COLLIDE--> 
      <a-box id="scanner" class="collidable"  sphere-collider="" height="5" width="0.5" depth="0.5" position="5 0 -10"  color="black"></a-box>
      <a-box id="card" position="-1 1.6 -5" width="3" height="1.5" depth="0.5" look-at="#myCamera"
        animation=""
        animation__mousedown="property: position; to: 5 1.7 -9.5  ; dur: 2000; easing: linear; loop: false; startEvents: mousedown" 
        src="#studentcard_image" collide></a-box>

   
    </a-scene>
  </body>

  <!--NAVIGATE TO OTHER PAGES (LOCATIONS/VIDEOS) -->  
  <script> 
    document
      .querySelector("#o4")
      .addEventListener("click", e => {
        location.href = "o4.html";
    });
        document
      .querySelector("#g1")
      .addEventListener("click", e => {
        location.href = "g1.html";
    });
    document
      .querySelector("#video_o2")
      .addEventListener("click", e => {
        location.href = "../videos/o2.html";
    });
    

  </script>
    
 
</html>
